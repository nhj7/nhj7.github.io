<html>
<head>
<script>
function getMobileOperatingSystem() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
	console.log('userAgent', userAgent);
    // iOS detection
    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        return 'iOS';
    }

    // Android detection
    if (/android/i.test(userAgent)) {
        return 'Android';
    }

    // Windows Phone detection
    if (/windows phone/i.test(userAgent)) {
        return 'Windows Phone';
    }

    return 'unknown';
}

function testCal(){

	console.log(getMobileOperatingSystem());
	// 앱 스키마 활용 (앱이 설치된 경우)
	if (getMobileOperatingSystem() === 'iOS') {
		window.location.href = 'calshow://';  // iOS 캘린더
	} else if (getMobileOperatingSystem() === 'Android') {
		window.location.href = 'content://com.android.calendar/';  // Android 캘린더
	} else{
		alert(getMobileOperatingSystem());
	}
}

function openCalendarWithEvent() {
    const event = {
        title: '미팅',
        description: '프로젝트 논의',
        location: '회의실',
        startDate: '20240220T090000',
        endDate: '20240220T100000'
    };

    if (getMobileOperatingSystem() === 'iOS') {
        // iOS Calendar Schema
        // 포맷: calshow://[timestamp]
        const timestamp = new Date(event.startDate).getTime();
        const iosCalendarUrl = `calshow://${timestamp}`;

        // 새로운 이벤트 생성을 위한 스키마
        // 포맷: webcal:// 또는 webcalc://
        const iosNewEventUrl = `webcal://?title=${encodeURIComponent(event.title)}`
            + `&start=${encodeURIComponent(event.startDate)}`
            + `&end=${encodeURIComponent(event.endDate)}`
            + `&description=${encodeURIComponent(event.description)}`
            + `&location=${encodeURIComponent(event.location)}`;

        const iosIcs = `webcal://nhj7.github.io/test/test.ics`;

        //window.location.href = iosCalendarUrl;
        // 또는 새 이벤트 생성
        window.location.href = iosNewEventUrl;
    } 
    else if (getMobileOperatingSystem() === 'Android') {
        // Android Calendar Schema
        const androidCalendarUrl = 'content://com.android.calendar/time/'
            + new Date(event.startDate).getTime();

        // 새로운 이벤트 생성을 위한 인텐트
        const androidNewEventUrl = 'content://com.android.calendar/events'
            + `?title=${encodeURIComponent(event.title)}`
            + `&description=${encodeURIComponent(event.description)}`
            + `&location=${encodeURIComponent(event.location)}`
            + `&beginTime=${new Date(event.startDate).getTime()}`
            + `&endTime=${new Date(event.endDate).getTime()}`;

        //window.location.href = androidCalendarUrl;
        // 또는 새 이벤트 생성
        window.location.href = androidNewEventUrl;
    }
}


</script>
</head>
<body>
	<button onclick="openCalendarWithEvent()" large>캘린더 테스트 666</button>
</body>
</html>
